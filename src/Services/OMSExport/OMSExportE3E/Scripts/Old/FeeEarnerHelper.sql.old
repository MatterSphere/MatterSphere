
--CREATE USERS FROM 3E FOR TIMEKEEPERS THAT ARENT ALREADY MAPPED - LOOK OUT FOR USERS AND FEE EARNERS CREATED, BUT NO MAPPING DONE
--PUT TIMEKEEPERID IN USRADID FOR NOW AND USED TO LINK TO CREATE OTHER DBFEEEARNER ROW - MAY NOT WORK FOR OTHER CONFIGS
--TODO : ADD OTHER COLUMNS ?
INSERT INTO DBUSER
( 
	USRINITS
	, USRADID
	, USRALIAS
	, USRFULLNAME
	, USREXTID
	, USRWORKSFOR
)

SELECT 
	ISNULL ( TKPR.BILLINITIAL , '3E:' + CONVERT ( NVARCHAR ( 10 ) , TKPR.TKPRINDEX ) )
	, '3E:' + CONVERT ( NVARCHAR ( 10 ) , TKPR.TKPRINDEX )
	, '3E:' + CONVERT ( NVARCHAR ( 10 ) , TKPR.TKPRINDEX )
	, TKPR.DISPLAYNAME
	, TKPR.TKPRINDEX
	, -1 --DEFAULT
FROM 
	TE_3E_SUPPORT.DBO.TIMEKEEPER TKPR
WHERE
	TKPRINDEX NOT IN ( SELECT ( FEEEXTID ) FROM DBFEEEARNER )
	AND '3E:' + CONVERT ( NVARCHAR ( 10 ) , TKPR.TKPRINDEX ) NOT IN ( SELECT USRADID FROM DBUSER )
	
--NOW CREATE THE FEE EARNER ROWS
INSERT INTO DBFEEEARNER
(
	FEEUSRID
	, FEEEXTID
	, FEERESPONSIBLE
	, FEEACTIVE
)
SELECT
	USRID
	, USREXTID
	, 0 
	, 1
FROM
	DBUSER
WHERE
	DBUSER.USRADID LIKE '3E:%' AND 
	SUBSTRING ( DBUSER.USRADID , 4 , LEN ( USRADID ) ) NOT IN ( SELECT FEEEXTID FROM DBFEEEARNER )